

active-bots = []

context = local // cloudia - AWS-EC2 - AWS-ECS - local

web-driver {
  chrome-binary = "/Applications/Chromium.app/Contents/MacOS/Chromium"
  firefox-binary = "/Applications/Firefox.app/Contents/MacOS/firefox-bin"

  chromium.cache-dir = "/tmp/chromium/cache-dir"
  chromium.data-path = "/tmp/chromium/data-path"
  firefox.cache-dir = "/tmp/firefox/cache-dir"

  cache.max-entries = 20
  cache.max-age.seconds = 600
}

bot {
  booking {
    name = "Booking"
  }
  almundo {
    name = "Almundo"
  }
  bestday {
    name = "Bestday"
  }
  hoteles-com {
    name = "Hoteles.com"
  }
  despegar-com {
    name = "Despegar.com"
  }
  providers {
    name = "Providers"
  }
}

crawling {

  // Default for all bots:

  parallel-factor = 1
  headers {
    user-agent = "Mozilla/5.0 (Windows NT 6.3; rv:36.0) Gecko/20100101 Firefox/36.0"
  }

  max-retry-task = 0
  max-retry-proxy = 3

  data-base-path = "/tmp/htmls"

  screenshot {
    base-path = "/tmp/screenshots"
    page-ready-timeout-millis = 10000
    resolution-width = 320
    resolution-height = 192
    quality = 25
    type = "none"
  }

  // Config for each bot:

  almundo {
    page-load-timeout = 10
    max-retry = 6
    wait-to-retry = 2 // seconds
  }

  twitter {
      data-base-path="/tmp/htmls"
      max-retry-task=3
      proxy=false
      webdriver="chromium"
  }

  instagram {
      data-base-path="/tmp/htmls"
      max-retry-task=3
      proxy=false
      webdriver="firefox"
  }

  bestday {
    wait_for_loader_millis = 600000 // 10 minutes in millis
    proxy-switch = false
    headers {
      user-agent = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/53 (KHTML, like Gecko) Chrome/15.0.87"
    }
    domains {
      MX = "https://www.bestday.com.mx/"
      AR = "https://www.bestday.com.ar/"
    }
    base.html.id = "content"
    screenshot {
      type = "full"
      crop {
        selector {
          hotels = "li.hotel-item"
          hotel.id = "id"
        }
      }
    }
    webdriver = "chromium"
  }

  booking {
    base.html.id = "bodyconstraint"
    screenshot {
      type = "full"
      crop {
        selector {
          hotels = "div[data-hotelid]"
          hotel.id = "data-hotelid"
        }
      }
    }
    webdriver = "chromium"
  }

  hoteles-com {
    crawling-timeout = 10 // minutes
    scroll-timeout = 20 // seconds
    element-max-timeout = 900 // seconds
    element-check = 10 // seconds
    screenshot {
      type = "full"
      crop {
        selector {
          hotels = "li.hotel"
          hotel.id = "data-hotel-id"
        }
      }
    }
    headers {
      user-agent = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/53 (KHTML, like Gecko) Chrome/15.0.87"
    }
    domains {
      AR = "https://www.hoteles.com/"
      MX = "https://www.hoteles.com/"
      US = "https://www.hotels.com/"
      BR = "https://www.hoteis.com/"
      CO = "https://co.hoteles.com/"
    }
    base.html.id = "main-content"
    webdriver = "chromium"
  }

  tripadvisor {
    scroll-timeout = 20 // seconds
    page-load-timeout = 10
    max-retry = 6
    wait-to-retry = 2 // seconds
    headers {
      user-agent = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/53 (KHTML, like Gecko) Chrome/15.0.87"
    }
    domains {
      AR: "http://www.tripadvisor.com.ar",
      MX: "https://www.tripadvisor.com.mx",
      BR: "https://www.tripadvisor.com.br",
      CL: "https://www.tripadvisor.cl",
      CO: "https://www.tripadvisor.co",
    }
    base.html.id = "MAINWRAP"
    webdriver = "chromium"
  }

  trivago-com {
    max-retry = 6
    wait-to-retry = 2 // seconds
    headers {
      user-agent = "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/53 (KHTML, like Gecko) Chrome/15.0.87"
    }
    params_template = "/?aDateRange%5Barr%5D={0}&aDateRange%5Bdep%5D={1}&iPathId={2}&sOrderBy=relevance"
    domains {
      AR: "https://www.trivago.com.ar",
      BR: "https://www.trivago.com.br",
    }
    expand_otas = false
    base.html.id = "page_wrapper"
    webdriver = "chromium"
  }

  cvc-com {
    screenshot {
      type = "crop"
      crop {
        selector {
          hotels = ".//article[contains(@class,'result-box-main')]"
          hotel.id = "data-hotel-id"
        }
      }
    }
    base.html.id = "ember-application"
    webdriver = "firefox"
  }

  despegar-com {
    endpoint = "http://proxy"
    headers = {}
    page-load-timeout = 20
    max-retry = 6
    wait-to-retry = 1 // seconds
  }

  providers-standalone {
    context = standalone
    ean {
      base_url = "http://proxy/dbs-hotel-service/service/"
      rooms_by_geo_template = "roomsByGeoRegionIdSearch/{}/0/{}/{}/{}/{}/{}/A/es_AR?rateCriteria=standalone"
      timeout = 10
      max_retry = 1
      wait_to_retry = 2
      headers {
        X-Client: "Robotech",
        X-SKIP-BLACKLIST: "true"
      }
      providers = ["EXP", "WDW", "TOU", "HBS", "HOTUSA"]
    }
    latam {
      base_url = "http://proxy/dbs-hotel-service/service/"
      rooms_by_geo_template = "roomsByGeoRegionIdSearch/{}/0/{}/{}/{}/{}/{}/A/es_AR?rateCriteria=standalone"
      timeout = 10
      max_retry = 1
      wait_to_retry = 2
      headers {
        X-Client: "Robotech",
        X-SKIP-BLACKLIST: "true"
      }
      providers = ["EXP", "HBS", "POS", "TOU", "HDO", "DESP", "IHG", "HOTUSA", "IBE"]
    }
  }

  providers-package {
    context = package
    ean {
      base_url = "http://proxy/dbs-hotel-service/service/"
      rooms_by_geo_template = "roomsByGeoRegionIdSearch/{}/1/{}/{}/{}/{}/{}/A/es_AR?rateCriteria=standalone,package,opaque,b2b,advanced_purchase,full_purchase"
      timeout = 10
      max_retry = 1
      wait_to_retry = 2
      headers {
        X-Client: "Robotech",
        X-SKIP-BLACKLIST: "true"
      }
      providers = ["EXP", "WDW", "TOU", "HBS", "HOTUSA"]
    }
    latam {
      base_url = "http://proxy/dbs-hotel-service/service/"
      rooms_by_geo_template = "roomsByGeoRegionIdSearch/{}/1/{}/{}/{}/{}/{}/A/es_AR?rateCriteria=standalone,package,opaque,b2b,advanced_purchase,full_purchase"
      timeout = 10
      max_retry = 1
      wait_to_retry = 2
      headers {
        X-Client: "Robotech",
        X-SKIP-BLACKLIST: "true"
      }
      providers = ["EXP", "HBS", "POS", "TOU", "HDO", "DESP", "IHG", "HOTUSA", "IBE"]
    }
  }
}

parsing {
  booking {
    x-path {
      "html_items": [".//div[contains(@class,'sr_item') and contains(@class, 'sr_item_new') and contains(@class, 'sr_item_default')]"],
      "hotel_raw_city": [".//input[@name='ss']/@value"],
      "hotel_list": ".//div[contains(@class, 'sr_item sr_item_new ')]",
      "hotel_id": [".//@data-hotelid"],
      "hotel_name": [".//span[contains(@class,'sr-hotel__name')]/text()"],
      "hotel_latitude_longitude": ["//@data-coords"],
      "hotel_class": [".//i[contains(@class, 'b-sprite stars ratings_stars_')]/@class"],
      "hotel_url": [".//a[@class='hotel_name_link url']/@href"],
      "hotel_price": [".//div[@class='sr-prc--num sr-prc--final']/text()",
        ".//strong[contains(@class,'price')]/b/text()",
        ".//div[contains(@class,'bui-price-display__value')]/text()"
      ],
      "hotel_location": [".//div[contains(@class,'address')]/a/span[2]/text()",
        ".//div[contains(@class,'address')]/a/text()",
        ".//a[contains(@class,'visited_link')]/strong/text()",
        ".//div[contains(@class,'address')]/a/*",
        "//div[contains(@class, 'address')]/*/text()"
      ],
      "hotel_prefer": [".//i[@class='b-sprite icon_deal_smart jq_tooltip']"],
      "hotel_max_persons": [".//div[contains(@class,'sr_max_occupancy')]/span[@class='invisible_spoken']/text()",
        ".//td[@class='roomName']//span[@class='invisible_spoken']/text()",
        ".//div[contains(@class,'sr_max_occupancy')]/span[@class='invisible_spoken']/text()",
        ".//span[@class='occupancy_multiplier_number']/text()"
      ],
      "hotel_room_name": [".//div[@class='roomNameInner']/span[@class='room_link']/span[@class='room_link']/text()",
        ".//div[@class='roomNameInner']/span/text()",
        ".//div[@class='roomNameInner']/span/strong/text()",
        ".//div[@class='roomNameInner']/a/strong/text()",
        ".//div[@class='room_link']/span/strong/text()",
      ],
      "hotel_sold_out": [".//span[@class='sold_out_property']/div/h3/text()"],
      "hotel_rate_score": [".//div[@class='bui-review-score__badge']/text()"],
      "hotel_rate_conditions": [".//sup[@class='sr_room_reinforcement']/text()"],
      "hotel_flag_price_subtotal": [".//div[@class='sr-prc--sub']"],
      "hotel_rate_without_discount": [".//span[@data-deal-rack='rackrate']/text()"],
      "hotel_comments_qtty": [".//div[@class='bui-review-score__text']/text()"]
    }
  }

  bestday {
    x-path {
      "hotel_list": [
        ".//li[@class='hotel-item service-summary']",
        ".//div[contains(@class,'hotel-results-item bottom-shadow')]"
      ],
      "hotel_id": [".//@id"],
      "hotel_name": [
        ".//a[@class='hotel-name']/text()",
        ".//div[contains(@class,'hidden-sm hotel-results-item-title')]/a/h3/span/text()"
      ],
      "hotel_url": [
        ".//a[@class='hotel-name']/@href",
        ".//div[@class='col-xs-12 col-sm-12 col-md-11 hidden-sm hotel-results-item-title']/a/@href"
      ],
      "hotel_price": [
        ".//span[@class='currency']/span[@class='currency-price']/text()",
        ".//span[@class='hotel-results-item-price-prefix-rate']/text()[2]"
      ],
      "hotel_location": [
        ".//div[@class='details']/a/span/text()",
        ".//span[@class='hotel-results-item-location-name']/text()"
      ],
      "hotel_meal_plan": [
        ".//div[contains(@class,'last-chance')]/p/text()",
        ".//div[@class='hotel-results-mealplan-name']/strong/text()"
      ],
      "hotel_ratescore": [".//span[@class='reviews']/text()"],
      "pagination_elems": [".//div[contains(@class,'pagination')]"],
      "next_page": [".//li[@class='next']"],
      "pagination_end": [".//li[@class='next hidden']"],
      "resultsearch_mode": [".//div[@class='header-menu']"]
    }
  }

  tripadvisor {
    x-path {
      "hotel_list": [".//div[contains(@class,'prw_meta_hsx_responsive_listing')]"],
      "hotel_id": [".//div[contains(@class,'meta_listing')]/@data-locationid",
        ".//@data-locationid"],
      "hotel_otas": [".//div[contains(@class,'text-link no_cpu')]"]
      "hotel_otas_by_hotelid": [".//span[@class='ui_overlay ui_popover arrow_top light no_x small']//div[@data-locationid='{0}']",
        "//div[@data-locationid='{0}']//div[contains(@class,'text-link no_cpu')]"]
      "hotel_ota_first": [".//div[contains(@class,'premium_offer no_cpu')]"]
      "hotel_availability": [".//@data-navarea-availability"],
      "hotel_meal_plan": [".//div[contains(@class,'last-chance')]/p/text()"],
      "ota_description": [".//span[@class='vendor']/@title",
        ".//@data-vendorname"],
      "next_page": [".//a[@class='nav next ui_button primary taLnk']/@href",
        ".//a[contains(@class,'nav next taLnk ui_button primary')]/@href"],
      "hotel_name": [".//a[contains(@class,'property_title prominent')]/text()"],
      "hotel_url": [".//div[@class='listing_title']/a/@href"],
      "hotel_price": [".//@data-pernight"],
      "hotel_ratescore": [".//span[contains(@class,'ui_bubble_rating')]/@alt"],
      "hotel_comments": [".//a[contains(@class,'review_count')]/text()"]

    }
    domains {
      AR: "http://www.tripadvisor.com.ar",
      MX: "https://www.tripadvisor.com.mx",
      BR: "https://www.tripadvisor.com.br",
      CL: "https://www.tripadvisor.cl",
      CO: "https://www.tripadvisor.co",
    }

  }

  cvc-com {
    x-path {
      "hotel_id": ".//h3[@class='hotel-title']/@data-hotel-id",
      "hotel_name": ".//h3[@class='hotel-title']/span[@class='hotel-link']/text()",
      "hotel_price": ".//div[contains(@class,'actual-price')][not(name()='span')]/text()[3]",
      "hotel_location": ".//p[@class='hotel-location']/text()"
      "hotel_ratescore": ".//span[@class='rate-text']/text()"
      "hotel_list": ".//article[contains(@class,'result-box-main')]"
    }
  }

  trivago-com {
    x-path {
      "hotel_list": [".//li[contains(@class,'item-order__list-item')]"],
      "hotel_id": [".//@data-item"],
      "hotel_name": [".//div[contains(@class,'item__name')]/h3/@title",
        ".//div[contains(@class,'item__name')]/h2/@title",
        ".//div[contains(@class,'item-link name__copytext')]/@title",
        ".//span[contains(@class,'item-link name__copytext')]/@title"]
      "hotel_price": [".//@data-pernight"],
      "hotel_ratescore": [".//span[@itemprop='ratingValue']/text()"],
      "hotel_comments": [".//span[contains(@class,'review__count')]/text()"],
      "hotel_address": [".//p[contains(@class,'location-details')]/text()[1]"],
      "ota_description_first": [".//div[contains(@class,'item__best-details')]/div/em/text()"],
      "ota_price_first": [
        ".//section[@itemprop='makesOffer']/div[@itemprop='priceSpecification']/@data-bestprice",
        ".//div[@class='item__best-details']/div/meta[@itemprop='price']/@content",
        ".//div[contains(@class,'item__best-details')]/div/meta[@itemprop='price']/@content"
      ],
      "otas": [".//ul[@class='deal-other__top-alternatives']/li[contains(@class,'deal-other__offer')]"],
      "ota_description": [".//button/span[@class='deal-other__advertiser']/text()"],
      "ota_price": [".//button/strong[@class='deals__price']/text()"],
      "next_page": [".//a[@class='nav next ui_button primary taLnk']/@href"],

    }
    domains {
      AR: "https://www.trivago.com.ar/",
      BR: "https://www.trivago.com.br/",
    }

  }

  hoteles-com {
    x-path {
      "base_html": ".//li[contains(concat(' ', @class, ' '),' hotel ') and not(contains(concat(' ', @class, ' '),' expanded-area '))]",
      "hotel_id": ["data-hotel-id"],
      "hotel_data_accommodation_type": ["@data-accommodation-type"],
      "hotel_name": [".//h3[@class='p-name']/a/text()"],
      "hotel_price": [".//div[contains(@class, 'price')]/a/ins/text()",
        ".//div[contains(@class, 'price')]/a/strong/text()"],
      "hotel_price_sold_out": [".//p[@class='sold-out-message']"],
      "hotel_full_stay_price": [".//p[@class='total-price-per-stay']/strong"],
      "hotel_is_mod": ["boolean(.//div[contains(@class, 'pricing') and contains(@class, 'secret-price')])"],
      "hotel_star_rating": [".//span[@class='guest-rating-value']/strong/text()"],
      "hotel_url": [".//div[@class='image']/span/a/@href",
        ".//div[@class='description resp-module']/h3/a/@href"
      ],
      "hotel_location": [".//address[contains(@class, 'contact')]//text()",
        ".//address[contains(@class, 'address')]//text()",
        ".//div[contains(@class, 'location-info')]/a/text()"],
      "xpath_item": ".//li[contains(concat(' ', @class, ' '),' hotel ')]",
      "main_log_in_text": [".//a[contains(@class, 'user-avatar')]/text()"],
      "user_avatar_xpath": "//*[contains(@class, 'icon-avatar')]",
      "sica_sign_xpath": "//li[contains(@class, 'sica-sign-in')]//a",
      "email_xpath": "//*[@id='sign-in-email']",
      "password_xpath": "//*[@id='sign-in-password']",
      "sign_in_button": "//*[contains(@class, 'form-actions')]//button",
      "sign_out": "//*[contains(@class, 'logout')]",
      "log_in_identifier": [".//li[contains(@class, 'dark-bg')]"]
    }
  }
}

api {
  name = "Optimus Prime"
  port = 9291
}

worker {
  poll_interval = 60 // seconds
}

web-clients {
  captain-global {
    host = "http://localhost:9290"
    endpoints: {
      poll-crawling = "/c-global/crawling/task"
      post-crawling-result = "/c-global/crawling/result"
    }
    cert-path = "..."
  }
  alfred {
    host = "http://cnd-backend"
    endpoints: {
      all-currencies = "/alfred-service/v3/entities/currencyrates/ANY/ANY/ANY"
    }
    max_retry = 1
    timeout = 10
    wait_to_retry = 2
    x-client = "ic-hoteles"
  }
}

log {
  rotate {
    enabled = true
    path_file = "/tmp/logs"
    max_size = 10485760 // 1024*1024*10 = 10 MB
    backup_count = 15
  }
  console {
    enabled = true
  }
  level = 10 # CRITICAL = 50, ERROR = 40, WARNING = 30, INFO = 20, DEBUG = 10
}

s3 {
  bucket = "rbt-test"
  endpoint = "s3.amazonaws.com"
}


tracer {
  // sampler {
  //    type = "const"
  //    param = 1
  //}
  sampler {
    type = "ratelimiting"
    param = 0.2
  }
  local_agent {
    reporting_port = 5775
    reporting_host = "robotech-jaeger-01"
  }
  logging = True
  service_name = "optimus-prime"
}

ecs {
  metadata_url = "<url-for-ecs-metadata>"
  prometheus {
    register_url = "<url-prometheus-register>"
    deregister_url = "<url-prometheus-deregister>"
  }
}
dialect.enabled = true
